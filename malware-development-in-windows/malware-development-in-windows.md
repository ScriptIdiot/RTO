# Ethical Hacking Foundations: Malware Development in Windows

## Intro

### Background Knowledge Resources
- Windows API tutorial: http://zetcode.com/gui/winapi/
- Understanding Windows x64 Assembly: https://sonictk.github.io/asm_tutorial/
- Introduction to x64 Assembly:
https://software.intel.com/content/www/us/en/develop/articles/introduction-to-x64-assembly.html

### Common Red Team Tools
- Metasploit
- Empire
- Cobaltstrike
- https://github.com/rapid7/metasploit-payloads

### Malware Tools
- https://github.com/hasherezade/pe-bear-releases
- https://github.com/x64dbg/x64dbg 
- https://github.com/processhacker/processhacker 
- https://github.com/NationalSecurityAgency/ghidra 

Download Class VM Here: https://ln2.sync.com/dl/255bd1c90/tuvtu9mq-exveysfg-pm7kbpra-tfxesgp7/view/default/10747646850008
Import into virtualbox and create a shared folder with host

## PE Files

File format represenations: https://github.com/corkami/pics

PE-bear program can exam PE files

dumpbin in virtual studio code: https://docs.microsoft.com/en-us/cpp/build/reference/dumpbin-reference?view=msvc-160 = prints out metadata

exe v dll

exe = loaded into memory as independent process

dll = dynamic loaded libraries, pmodule loaded into existing processes that cannot live independently in memory: calls process needs

to generate pfile: source code -> compiler -> machine code (read by cpu, executed in process)

exe (needs a main function) and dll (function dll main called, then function exported) are called differently

run compile.exe, use processhacker to investigate

rundll32 allows dlls to be run in a process
eg rundll32 implant.dll,RunME

## Payload storage

Droppers: deliver payloads to machine and executes it

where to store
 * text (in a function (mainfunction))
 * data (read only data, global variable holding payload)
 * rsrc (store as resource)

## Payload encoding and encryption

Encoding v encryption (requires cipher to convert plaintext to ciphertext) (aes, xor method)

Encoding: transforming data for a different system (base64)

certutil -encode calc.bin calc.b64 = to encode in windows

base64 is still easily detectable by av